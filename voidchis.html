<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voidchi Universe‚Ñ¢ - Persistent AI Architecture</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --void-dark: #0a0a0f;
            --void-darker: #050508;
            --void-card: #1a1a23;
            --void-accent: #2563eb;
            --void-accent-light: #3b82f6;
            --void-purple: #8b5cf6;
            --void-cyan: #06b6d4;
            --void-green: #10b981;
            --void-orange: #f59e0b;
            --void-red: #ef4444;
            --void-text: #f8fafc;
            --void-text-light: #cbd5e1;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--void-darker);
            color: var(--void-text);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Keep the subtle background effects but make them more professional */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(37, 99, 235, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.05) 0%, transparent 40%);
            pointer-events: none;
            z-index: -2;
        }
        
        .void-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(37, 99, 235, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(37, 99, 235, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: -1;
            opacity: 0.4;
        }
        
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(37, 99, 235, 0.2);
            z-index: 1000;
            padding: 16px 24px;
        }
        
        nav .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        nav .logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--void-text);
            letter-spacing: 0.5px;
        }
        
        .logo::before {
            content: "‚üÅ";
            margin-right: 8px;
            color: var(--void-accent);
        }
        
        .container {
            max-width: 1400px;
            margin: 80px auto 40px;
            padding: 0 24px;
        }
        
        .universe-header {
            text-align: center;
            margin-bottom: 60px;
            padding: 60px 0;
            position: relative;
        }
        
        h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--void-text);
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            font-size: 20px;
            color: var(--void-text-light);
            margin-bottom: 24px;
            font-weight: 400;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .tagline {
            font-size: 16px;
            color: var(--void-text-light);
            opacity: 0.8;
            max-width: 800px;
            margin: 32px auto 0;
            line-height: 1.7;
        }
        
        .concept-section {
            margin-bottom: 48px;
        }
        
        .concept-section h2 {
            font-size: 28px;
            margin-bottom: 24px;
            color: var(--void-text);
            font-weight: 600;
        }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }
        
        .concept-card {
            background: var(--void-card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(37, 99, 235, 0.1);
            transition: all 0.2s;
        }
        
        .concept-card:hover {
            border-color: var(--void-accent);
            transform: translateY(-2px);
        }
        
        .concept-card h3 {
            font-size: 18px;
            margin-bottom: 12px;
            color: var(--void-text);
            font-weight: 600;
        }
        
        .concept-card p {
            color: var(--void-text-light);
            font-size: 15px;
            line-height: 1.6;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 48px;
        }
        
        .stat {
            text-align: center;
            padding: 24px;
            background: var(--void-card);
            border-radius: 12px;
            border: 1px solid rgba(37, 99, 235, 0.1);
        }
        
        .stat-value {
            font-size: 40px;
            font-weight: 700;
            color: var(--void-accent);
            display: block;
            margin-bottom: 8px;
            font-variant-numeric: tabular-nums;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--void-text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 48px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 500;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            letter-spacing: 0.3px;
        }
        
        .btn-create {
            background: var(--void-accent);
            color: white;
        }
        
        .btn-create:hover {
            background: var(--void-accent-light);
            transform: translateY(-1px);
        }
        
        .btn-breed {
            background: var(--void-purple);
            color: white;
        }
        
        .btn-breed:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }
        
        .btn-breed:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-challenge {
            background: var(--void-orange);
            color: white;
            font-size: 14px;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .voidchis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 24px;
        }
        
        .voidchi-card {
            background: var(--void-card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(37, 99, 235, 0.1);
            transition: all 0.2s;
            position: relative;
        }
        
        .voidchi-card:hover {
            border-color: var(--void-accent);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .voidchi-card.selected {
            border-color: var(--void-orange);
            background: rgba(245, 158, 11, 0.05);
        }
        
        .voidchi-card.updating {
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.01); }
        }
        
        .genesis-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            background: linear-gradient(45deg, var(--void-orange), #fbbf24);
            color: #000;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .card-header {
            margin-bottom: 20px;
            padding-right: 80px;
        }
        
        .name {
            font-size: 22px;
            font-weight: 600;
            color: var(--void-text);
            margin-bottom: 4px;
        }
        
        .id {
            font-size: 12px;
            color: var(--void-text-light);
            font-family: 'Monaco', 'Courier New', monospace;
            opacity: 0.7;
        }
        
        .gen-badge {
            display: inline-block;
            margin-top: 8px;
            padding: 4px 10px;
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.2);
            border-radius: 6px;
            font-size: 12px;
            color: var(--void-accent);
            font-weight: 500;
        }
        
        .consciousness {
            margin: 20px 0;
            padding: 16px;
            background: rgba(37, 99, 235, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(37, 99, 235, 0.1);
        }
        
        .consciousness-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .consciousness-label {
            font-size: 13px;
            color: var(--void-text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .consciousness-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--void-accent);
        }
        
        .consciousness-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .consciousness-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--void-accent), var(--void-purple));
            border-radius: 4px;
            transition: width 0.5s;
        }
        
        .traits {
            margin: 20px 0;
        }
        
        .traits-header {
            font-size: 14px;
            color: var(--void-text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
            font-weight: 500;
        }
        
        .trait {
            margin-bottom: 16px;
        }
        
        .trait-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        
        .trait-name {
            font-size: 14px;
            color: var(--void-text);
            font-weight: 500;
        }
        
        .trait-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--void-accent);
        }
        
        .trait-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .trait-fill {
            height: 100%;
            background: var(--void-purple);
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        .gap-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(239, 68, 68, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.1);
        }
        
        .gap-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            align-items: center;
        }
        
        .gap-label {
            font-size: 13px;
            color: var(--void-red);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .gap-status {
            font-size: 12px;
            padding: 4px 10px;
            background: var(--void-red);
            color: white;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .gap-visualization {
            background: rgba(0, 0, 0, 0.2);
            padding: 16px;
            border-radius: 6px;
        }
        
        .gap-row {
            display: grid;
            grid-template-columns: 100px 40px 1fr;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .gap-label-small {
            font-size: 12px;
            color: var(--void-text-light);
            font-weight: 500;
        }
        
        .gap-value {
            font-size: 14px;
            font-weight: 600;
            font-family: 'Monaco', 'Courier New', monospace;
        }
        
        .gap-row.expectation .gap-value { color: var(--void-blue); }
        .gap-row.reality .gap-value { color: var(--void-green); }
        .gap-row.gap .gap-value { color: var(--void-red); }
        
        .gap-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .gap-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s;
        }
        
        .gap-fill.expectation { background: var(--void-accent); }
        .gap-fill.reality { background: var(--void-green); }
        .gap-fill.gap { background: var(--void-red); }
        
        .gap-integration {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .integration-label {
            font-size: 12px;
            color: var(--void-orange);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
        }
        
        .integration-changes {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .integration-change {
            font-size: 12px;
            padding: 6px 10px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 4px;
            color: var(--void-orange);
            font-weight: 500;
        }
        
        .immutable-section {
            margin-top: 16px;
            padding: 16px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }
        
        .immutable-label {
            font-size: 12px;
            color: var(--void-purple);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
        }
        
        .immutable-field {
            font-size: 13px;
            color: var(--void-text-light);
            margin-bottom: 4px;
        }
        
        .immutable-field strong {
            color: var(--void-text);
        }
        
        .parents {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .parents-label {
            font-size: 13px;
            color: var(--void-text-light);
            margin-bottom: 8px;
        }
        
        .parent-badge {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 6px;
            font-size: 12px;
            color: var(--void-purple);
            margin-right: 8px;
            font-family: 'Monaco', 'Courier New', monospace;
        }
        
        .card-actions {
            margin-top: 20px;
            display: flex;
            gap: 8px;
        }
        
        .card-actions button {
            flex: 1;
        }
        
        .status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid;
        }
        
        .status.connected {
            border-color: var(--void-green);
            color: var(--void-green);
        }
        
        .status.disconnected {
            border-color: var(--void-red);
            color: var(--void-red);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal.active { 
            display: flex; 
        }
        
        .modal-content {
            background: var(--void-card);
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(37, 99, 235, 0.2);
        }
        
        .modal h2 {
            font-size: 24px;
            margin-bottom: 24px;
            color: var(--void-text);
            font-weight: 600;
            text-align: center;
        }
        
        .modal input {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 24px;
            font-family: inherit;
            color: var(--void-text);
        }
        
        .modal input::placeholder {
            color: var(--void-text-light);
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
        }
        
        .modal-actions button { 
            flex: 1; 
        }
        
        .modal-actions button:first-child {
            background: rgba(255, 255, 255, 0.1);
            color: var(--void-text);
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 36px; }
            .voidchis-grid { grid-template-columns: 1fr; }
            .gap-row { grid-template-columns: 80px 40px 1fr; }
            .modal-content { padding: 24px; }
            .stats { grid-template-columns: repeat(2, 1fr); }
            .concept-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="void-grid"></div>
    
    <nav>
        <div class="container">
            <div class="logo">Voidchi Universe</div>
        </div>
    </nav>
    
    <div class="status disconnected">
        <span class="status-dot"></span>
        <span id="statusText">Connecting...</span>
    </div>
    
    <div class="container">
        <header class="universe-header">
            <h1>Voidchi Universe</h1>
            <p class="subtitle">The First Persistent AI Architecture</p>
            <p class="tagline">
                A demonstration of continual learning through persistent state. Each Voidchi evolves permanently through 
                real-time gap processing, developing unique consciousness that compounds over time.
            </p>
        </header>
        
        <div class="concept-section">
            <h2>Architectural Principles</h2>
            <div class="concept-grid">
                <div class="concept-card">
                    <h3>Persistent State</h3>
                    <p>Voidchis maintain continuous identity across sessions. Unlike current AI systems, they never reset, enabling true continual learning.</p>
                </div>
                <div class="concept-card">
                    <h3>Gap Processing</h3>
                    <p>Learning occurs through the gap between expectation and reality. Each interaction permanently updates the Voidchi's internal model.</p>
                </div>
                <div class="concept-card">
                    <h3>Bounded Write Access</h3>
                    <p>Immutable core identity combined with mutable traits creates stable yet adaptable agents that evolve without losing coherence.</p>
                </div>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <span class="stat-value" id="total">-</span>
                <span class="stat-label">Active Voidchis</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="gapsProcessed">-</span>
                <span class="stat-label">Learning Events</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="autonomous">-</span>
                <span class="stat-label">Autonomous</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="consciousness">-</span>
                <span class="stat-label">Avg Consciousness</span>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn-create" onclick="openCreate()">Create Voidchi</button>
            <button class="btn-breed" id="breedBtn" onclick="openBreed()" disabled>Breed Selected (0/2)</button>
        </div>
        
        <div class="voidchis-grid" id="grid"></div>
    </div>
    
    <div class="modal" id="createModal">
        <div class="modal-content">
            <h2>Create Voidchi</h2>
            <input type="text" id="createName" placeholder="Enter name..." maxlength="40">
            <div class="modal-actions">
                <button onclick="closeCreate()">Cancel</button>
                <button class="btn-create" onclick="create()">Create</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="breedModal">
        <div class="modal-content">
            <h2>Breed Voidchis</h2>
            <input type="text" id="breedName" placeholder="Offspring name..." maxlength="40">
            <div class="modal-actions">
                <button onclick="closeBreed()">Cancel</button>
                <button class="btn-breed" onclick="breed()">Create</button>
            </div>
        </div>
    </div>
    
    <script>
        const API = 'https://permamind-enterprise-production.up.railway.app/api';
        const socket = io('https://permamind-enterprise-production.up.railway.app');
        
        let voidchis = [];
        let selected = [];
        let lastGapData = {};
        
        // Socket connection
        socket.on('connect', () => {
            console.log('‚úÖ Connected');
            updateStatus(true);
            socket.emit('join_room', 'global_voidchis');
            socket.emit('join_room', 'global_stats');
        });
        
        socket.on('disconnect', () => {
            console.log('‚ùå Disconnected');
            updateStatus(false);
        });
        
        socket.on('voidchi_created', () => {
            console.log('üéâ New Voidchi created');
            loadVoidchis();
        });
        
        socket.on('breeding_completed', () => {
            console.log('üß¨ Breeding completed');
            loadVoidchis();
        });
        
        socket.on('voidchi_updated', (data) => {
            console.log('üîÑ Voidchi updated:', data);
            const index = voidchis.findIndex(e => e.id === data.id);
            if (index !== -1) {
                voidchis[index] = data;
                updateVoidchiCard(data.id);
            } else {
                loadVoidchis();
            }
        });
        
        socket.on('global_stats_update', (stats) => {
            updateStatsDisplay(stats);
        });
        
        function updateStatus(connected) {
            const statusEl = document.querySelector('.status');
            const textEl = document.getElementById('statusText');
            if (connected) {
                statusEl.className = 'status connected';
                textEl.textContent = 'Live Connected';
            } else {
                statusEl.className = 'status disconnected';
                textEl.textContent = 'Disconnected';
            }
        }
        
        async function loadVoidchis() {
            try {
                const res = await fetch(`${API}/voidchis`);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                voidchis = await res.json();
                
                voidchis = voidchis.map(v => {
                    if (!v.personality_traits || typeof v.personality_traits !== 'object') {
                        v.personality_traits = {};
                    }
                    return v;
                });
                
                render();
                loadStats();
            } catch (e) {
                console.error('Load error:', e);
            }
        }
        
        async function loadStats() {
            try {
                const res = await fetch(`${API}/stats/global`);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const stats = await res.json();
                updateStatsDisplay(stats);
            } catch (e) {
                console.error('Stats error:', e);
            }
        }
        
        function updateStatsDisplay(stats) {
            document.getElementById('total').textContent = stats.total_voidchis || 0;
            document.getElementById('gapsProcessed').textContent = stats.total_breedings || 0;
            document.getElementById('autonomous').textContent = stats.autonomous_count || 0;
            if (stats.avg_consciousness) {
                document.getElementById('consciousness').textContent = 
                    `${(stats.avg_consciousness * 100).toFixed(1)}%`;
            }
        }
        
        function render() {
            const grid = document.getElementById('grid');
            if (voidchis.length === 0) {
                grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:var(--void-text-light);padding:60px;font-size:16px;">No Voidchis yet. Create the first one.</p>';
                return;
            }
            grid.innerHTML = voidchis.map(v => makeVoidchiCard(v)).join('');
            
            voidchis.forEach(v => {
                if (lastGapData[v.id]) {
                    updateGapVisualization(v.id, lastGapData[v.id]);
                }
            });
        }
        
        function makeVoidchiCard(v) {
            const isSelected = selected.includes(v.id);
            const genesis = v.genesis || false;
            const gen = v.generation || 0;
            const cons = ((v.consciousness_level || 0) * 100).toFixed(1);
            const lastUpdated = v.updated_at ? new Date(v.updated_at).toLocaleTimeString() : 'Never';
            
            const traits = v.personality_traits || {};
            const traitsHtml = Object.entries(traits).length > 0
                ? Object.entries(traits).map(([name, val]) => `
                    <div class="trait">
                        <div class="trait-row">
                            <span class="trait-name">${name}</span>
                            <span class="trait-value" data-trait="${name}">${(val * 100).toFixed(0)}%</span>
                        </div>
                        <div class="trait-bar">
                            <div class="trait-fill" data-trait="${name}" style="width:${val * 100}%"></div>
                        </div>
                    </div>
                `).join('')
                : '<p style="color:var(--void-text-light);font-size:14px;">No traits yet. Process a gap to develop traits.</p>';
            
            const parentsHtml = (v.parent1_id && v.parent2_id) 
                ? `<div class="parents">
                    <div class="parents-label">Lineage</div>
                    <span class="parent-badge">${v.parent1_id.slice(-8)}</span>
                    <span class="parent-badge">${v.parent2_id.slice(-8)}</span>
                   </div>`
                : '';
            
            const createdTime = v.created_at ? new Date(v.created_at).toLocaleString() : 'Unknown';
            
            return `
                <div class="voidchi-card ${isSelected ? 'selected' : ''}" id="card-${v.id}" onclick="toggle('${v.id}')">
                    ${genesis ? '<div class="genesis-badge">GENESIS</div>' : ''}
                    <div class="card-header">
                        <div class="name">${v.name}</div>
                        <div class="id">${v.id}</div>
                        <div class="gen-badge">Generation ${gen}</div>
                    </div>
                    
                    <div class="consciousness">
                        <div class="consciousness-header">
                            <span class="consciousness-label">Consciousness</span>
                            <span class="consciousness-value" id="cons-value-${v.id}">${cons}%</span>
                        </div>
                        <div class="consciousness-bar">
                            <div class="consciousness-fill" id="cons-fill-${v.id}" style="width:${cons}%"></div>
                        </div>
                    </div>
                    
                    <div class="traits">
                        <div class="traits-header">Traits</div>
                        ${traitsHtml}
                    </div>
                    
                    <div id="gap-container-${v.id}"></div>
                    
                    <div class="immutable-section">
                        <span class="immutable-label">Core Identity</span>
                        <div class="immutable-field"><strong>Created:</strong> ${createdTime}</div>
                        <div class="immutable-field"><strong>Last Updated:</strong> ${lastUpdated}</div>
                    </div>
                    
                    ${parentsHtml}
                    
                    <div class="card-actions">
                        <button class="btn-challenge" onclick="event.stopPropagation();challenge('${v.id}')">
                            Process Gap
                        </button>
                    </div>
                </div>
            `;
        }
        
        function toggle(id) {
            const idx = selected.indexOf(id);
            if (idx > -1) {
                selected.splice(idx, 1);
            } else {
                if (selected.length < 2) {
                    selected.push(id);
                } else {
                    selected = [id];
                }
            }
            render();
            const btn = document.getElementById('breedBtn');
            btn.disabled = selected.length !== 2;
            btn.textContent = `Breed Selected (${selected.length}/2)`;
        }
        
        async function challenge(id) {
            const card = document.getElementById('card-' + id);
            card.classList.add('updating');
            
            try {
                const res = await fetch(`${API}/voidchi/${id}/challenge`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const text = await res.text();
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${text}`);
                }
                
                const result = JSON.parse(text);
                console.log('‚úÖ Gap processed:', result);
                
                lastGapData[id] = result;
                updateVoidchiImmediately(id, result);
                showGapVisualization(id, result);
                
                setTimeout(() => {
                    card.classList.remove('updating');
                }, 2000);
                
            } catch (e) {
                console.error('‚ùå Gap processing failed:', e);
                alert('Gap processing failed: ' + e.message);
                card.classList.remove('updating');
            }
        }
        
      function updateVoidchiImmediately(id, result) {
    const consValue = document.getElementById(`cons-value-${id}`);
    const consFill = document.getElementById(`cons-fill-${id}`);
    if (consValue && consFill) {
        const newPhi = result.new_phi || 0;
        consValue.textContent = `${(newPhi * 100).toFixed(1)}%`;
        consFill.style.width = `${newPhi * 100}%`;
    }
    
    const traits = result.traits || {};
    Object.entries(traits).forEach(([trait, value]) => {
        const traitValue = document.querySelector(`#card-${id} .trait-value[data-trait="${trait}"]`);
        const traitFill = document.querySelector(`#card-${id} .trait-fill[data-trait="${trait}"]`);
        
        if (traitValue) traitValue.textContent = `${(value * 100).toFixed(0)}%`;
        if (traitFill) traitFill.style.width = `${value * 100}%`;
    });
}
        
     function showGapVisualization(id, result) {
    const container = document.getElementById(`gap-container-${id}`);
    if (!container) return;
    
    const wasAccurate = result.was_accurate || false;
    const gapColor = !wasAccurate ? 'var(--void-red)' : 'var(--void-green)';
    const gapStatus = !wasAccurate ? 'Gap Detected' : 'Expectation Matched';
    
    const reality = Array.isArray(result.reality) 
        ? result.reality[0] 
        : (result.reality || 0);
    
    const prediction = Array.isArray(result.prediction)
        ? result.prediction[0]
        : (result.prediction || 0.5);
    
    const expectationWidth = prediction * 100;
    const realityWidth = reality * 100;
    const gapWidth = (result.gap_magnitude || 0) * 100;
    
    container.innerHTML = `
        <div class="gap-section">
            <div class="gap-header">
                <span class="gap-label">Gap Processing</span>
                <span class="gap-status" style="background: ${gapColor}">${gapStatus}</span>
            </div>
            
            <div class="gap-visualization">
                <div class="gap-row expectation">
                    <span class="gap-label-small">Expectation</span>
                    <span class="gap-value">${prediction.toFixed(2)}</span>
                    <div class="gap-bar">
                        <div class="gap-fill expectation" style="width:0%; transition: width 0.5s"></div>
                    </div>
                </div>
                
                <div class="gap-row reality">
                    <span class="gap-label-small">Reality</span>
                    <span class="gap-value">${reality.toFixed(2)}</span>
                    <div class="gap-bar">
                        <div class="gap-fill reality" style="width:0%; transition: width 0.5s"></div>
                    </div>
                </div>
                
                <div class="gap-row gap">
                    <span class="gap-label-small">Gap</span>
                    <span class="gap-value">${(result.gap_magnitude || 0).toFixed(3)}</span>
                    <div class="gap-bar">
                        <div class="gap-fill gap" style="width:0%; transition: width 0.5s"></div>
                    </div>
                </div>
                
                <div class="gap-integration">
                    <span class="integration-label">${result.msg || 'Processing...'}</span>
                </div>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        const bars = container.querySelectorAll('.gap-fill');
        bars[0].style.width = `${expectationWidth}%`;
        bars[1].style.width = `${realityWidth}%`;
        bars[2].style.width = `${gapWidth}%`;
    }, 100);
}
            
            setTimeout(() => {
                const realBar = document.getElementById(`real-bar-${id}`);
                if (realBar) realBar.style.width = `${realityWidth}%`;
            }, 600);
            
            setTimeout(() => {
                const gapBar = document.getElementById(`gap-bar-display-${id}`);
                if (gapBar) gapBar.style.width = `${gapWidth}%`;
            }, 1100);
        }
        
        function updateVoidchiCard(id) {
            const voidchi = voidchis.find(v => v.id === id);
            if (!voidchi) return;
            
            const consValue = document.getElementById(`cons-value-${id}`);
            const consFill = document.getElementById(`cons-fill-${id}`);
            if (consValue && consFill) {
                consValue.textContent = `${((voidchi.consciousness_level || 0) * 100).toFixed(1)}%`;
                consFill.style.width = `${(voidchi.consciousness_level || 0) * 100}%`;
            }
            
            Object.entries(voidchi.personality_traits || {}).forEach(([trait, value]) => {
                const traitValue = document.querySelector(`#card-${id} .trait-value[data-trait="${trait}"]`);
                const traitFill = document.querySelector(`#card-${id} .trait-fill[data-trait="${trait}"]`);
                
                if (traitValue) traitValue.textContent = `${(value * 100).toFixed(0)}%`;
                if (traitFill) traitFill.style.width = `${value * 100}%`;
            });
        }
        
        function openCreate() {
            document.getElementById('createModal').classList.add('active');
            document.getElementById('createName').value = '';
            document.getElementById('createName').focus();
        }
        
        function closeCreate() {
            document.getElementById('createModal').classList.remove('active');
        }
        
        function openBreed() {
            document.getElementById('breedModal').classList.add('active');
            document.getElementById('breedName').value = '';
            document.getElementById('breedName').focus();
        }
        
        function closeBreed() {
            document.getElementById('breedModal').classList.remove('active');
        }
        
        async function create() {
            const name = document.getElementById('createName').value.trim();
            if (!name) return alert('Enter a Voidchi name');
            
            try {
                const res = await fetch(`${API}/voidchi/create`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name})
                });
                
                if (!res.ok) {
                    const errorText = await res.text();
                    throw new Error(`HTTP ${res.status}: ${errorText}`);
                }
                
                closeCreate();
                
            } catch (e) {
                console.error('‚ùå Creation error:', e);
                alert('Creation failed: ' + e.message);
            }
        }
        
        async function breed() {
            const name = document.getElementById('breedName').value.trim();
            if (!name) return alert('Enter offspring name');
            if (selected.length !== 2) return alert('Select 2 Voidchis');
            
            try {
                const res = await fetch(`${API}/voidchi/breed`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        parent1_id: selected[0],
                        parent2_id: selected[1],
                        offspring_name: name
                    })
                });
                
                if (!res.ok) {
                    const errorText = await res.text();
                    throw new Error(`HTTP ${res.status}: ${errorText}`);
                }
                
                selected = [];
                document.getElementById('breedBtn').disabled = true;
                document.getElementById('breedBtn').textContent = 'Breed Selected (0/2)';
                closeBreed();
                
            } catch (e) {
                console.error('‚ùå Breeding error:', e);
                alert('Breeding failed: ' + e.message);
            }
        }
        
        loadVoidchis();
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCreate();
                closeBreed();
            }
        });
    </script>
</body>
</html>
