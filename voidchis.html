<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voidchiâ„¢ Universe - Shared AI Breeding Experiment</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --white: #ffffff; --near-white: #f5f5f7; --light-gray: #d2d2d7;
            --mid-gray: #86868b; --dark-gray: #1d1d1f; --black: #000000;
            --accent: #0071e3; --accent-hover: #0077ed; --success: #34c759;
            --warning: #ff9500; --danger: #ff3b30; --info: #5ac8fa;
            --graduation: #af52de; --genesis-gold: #FFD700;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif; background: var(--white); color: var(--dark-gray); line-height: 1.6; -webkit-font-smoothing: antialiased; }
        nav { position: fixed; top: 0; width: 100%; background: rgba(255, 255, 255, 0.8); backdrop-filter: saturate(180%) blur(20px); border-bottom: 1px solid var(--light-gray); z-index: 1000; }
        nav .container { max-width: 1200px; margin: 0 auto; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; }
        nav .logo { font-size: 20px; font-weight: 600; color: var(--dark-gray); text-decoration: none; letter-spacing: -0.5px; }
        nav a { color: var(--dark-gray); text-decoration: none; font-size: 14px; margin-left: 32px; transition: opacity 0.3s ease; }
        .container { max-width: 1200px; margin: 0 auto; padding: 100px 20px 60px; }
        header { text-align: center; margin-bottom: 60px; }
        h1 { font-size: 56px; font-weight: 600; letter-spacing: -1.5px; line-height: 1.1; margin-bottom: 16px; }
        .subtitle { font-size: 21px; color: var(--mid-gray); max-width: 700px; margin: 0 auto 40px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 60px; padding: 40px; background: var(--near-white); border-radius: 16px; }
        .stat-value { font-size: 48px; font-weight: 600; }
        .stat-label { font-size: 14px; color: var(--mid-gray); text-transform: uppercase; }
        .actions { display: flex; gap: 16px; margin-bottom: 40px; flex-wrap: wrap; }
        button { padding: 12px 24px; font-size: 17px; border-radius: 24px; border: none; cursor: pointer; transition: all 0.3s ease; }
        .btn-primary { background: var(--accent); color: var(--white); }
        .btn-secondary { background: var(--success); color: var(--white); }
        .btn-secondary:disabled { opacity: 0.4; cursor: not-allowed; }
        .voidchi-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px; }
        .voidchi-card { background: var(--white); border: 1px solid var(--light-gray); border-radius: 16px; padding: 24px; cursor: pointer; position: relative; transition: all 0.3s ease; }
        .voidchi-card.selected { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1); }
        .genesis-badge { position: absolute; top: -10px; left: -10px; background: var(--genesis-gold); color: var(--dark-gray); padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: 700; text-transform: uppercase; z-index: 1; border: 1px solid rgba(0,0,0,0.1); }
        .voidchi-name { font-size: 21px; font-weight: 600; cursor: help; text-decoration: underline dotted var(--light-gray); }
        .trait-row { margin-bottom: 16px; }
        .trait-bar { height: 6px; background: var(--near-white); border-radius: 3px; overflow: hidden; }
        .trait-fill { height: 100%; background: var(--accent); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(10px); z-index: 2000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--white); border-radius: 16px; padding: 32px; max-width: 480px; width: 90%; }
        input { width: 100%; padding: 12px; background: var(--near-white); border: 1px solid var(--light-gray); border-radius: 8px; font-size: 17px; margin-top: 10px; }
        .connection-status { position: fixed; bottom: 20px; right: 20px; padding: 8px 16px; border-radius: 20px; font-size: 12px; z-index: 1001; }
        .connection-status.connected { background: rgba(52, 199, 89, 0.1); color: var(--success); }
    </style>
</head>
<body>
    <nav><div class="container"><a href="/" class="logo">PermaMind</a><div><a href="/">Home</a><a href="/voidchis.html">Demo</a></div></div></nav>
    <div id="connectionStatus" class="connection-status connected"><span>Live Universe Connected</span></div>
    
    <div class="container">
        <header><h1>Voidchiâ„¢ Universe</h1><p class="subtitle">A living AI ecosystem with immutable history and provable lineage.</p></header>
        <div class="stats">
            <div class="stat"><div class="stat-value" id="totalVoidchis">0</div><div class="stat-label">Citizens</div></div>
            <div class="stat"><div class="stat-value" id="generations">1</div><div class="stat-label">Generations</div></div>
        </div>

        <div class="actions">
            <button class="btn-primary" onclick="openCreateModal()">Create Voidchi</button>
            <button class="btn-secondary" id="breedBtn" onclick="openBreedModal()" disabled>Breed Selected (0/2)</button>
        </div>
        
        <div id="voidchiContainer"></div>
    </div>

    <div class="modal" id="createModal"><div class="modal-content"><h2>Create Voidchi</h2><form onsubmit="createVoidchi(event)"><input type="text" id="voidchiName" placeholder="Name" required><div class="modal-actions"><button type="button" onclick="closeCreateModal()">Cancel</button><button type="submit" class="btn-primary">Create</button></div></form></div></div>
    
    <div class="modal" id="breedModal"><div class="modal-content"><h2>ðŸ§¬ Breed Offspring</h2><form onsubmit="confirmBreeding(event)"><input type="text" id="offspringName" placeholder="Name" required><div class="modal-actions"><button type="button" onclick="closeBreedModal()">Cancel</button><button type="submit" class="btn-secondary">Breed</button></div></form></div></div>

    <div class="modal" id="certificateModal">
        <div class="modal-content" style="max-width: 550px; border: 2px solid var(--genesis-gold);">
            <h2>ðŸ“œ Identity Record</h2>
            <div id="certContent" style="background: var(--near-white); padding: 20px; border-radius: 10px; font-family: monospace; margin: 20px 0;"></div>
            <button class="btn-primary" onclick="closeCertModal()" style="width:100%">Close Record</button>
        </div>
    </div>

    <script>
        const API_BASE = 'https://permamind-enterprise-production.up.railway.app/api';
        const socket = io('https://permamind-enterprise-production.up.railway.app');
        let voidchis = [];
        let selectedVoidchis = [];

        async function loadVoidchis() {
            const res = await fetch(`${API_BASE}/voidchis`);
            voidchis = await res.json();
            renderVoidchis();
        }

        function renderVoidchis() {
            const container = document.getElementById('voidchiContainer');
            container.innerHTML = '<div class="voidchi-grid">' + voidchis.map(v => `
                <div class="voidchi-card ${selectedVoidchis.includes(v.id) ? 'selected' : ''}" onclick="toggleSelect('${v.id}')">
                    ${v.genesis ? '<div class="genesis-badge">ðŸŒŸ Genesis</div>' : ''}
                    <div class="voidchi-name" onclick="openCertModal(event, '${v.id}')">${v.name} â“˜</div>
                    <div style="font-size:12px; color:var(--mid-gray); margin-bottom:15px;">Gen ${v.generation || 0}</div>
                    <div class="trait-row"><div class="trait-bar"><div class="trait-fill" style="width:${(v.personality_traits.curiosity || 0.5)*100}%"></div></div></div>
                </div>
            `).join('') + '</div>';
            document.getElementById('totalVoidchis').textContent = voidchis.length;
            document.getElementById('generations').textContent = Math.max(...voidchis.map(v => v.generation || 0)) + 1;
        }

        function toggleSelect(id) {
            const v = voidchis.find(chi => chi.id === id);
            if (v && v.genesis) { alert("Genesis Founders cannot breed. They are the root of history."); return; }
            const idx = selectedVoidchis.indexOf(id);
            if (idx > -1) selectedVoidchis.splice(idx, 1);
            else if (selectedVoidchis.length < 2) selectedVoidchis.push(id);
            renderVoidchis();
            document.getElementById('breedBtn').disabled = selectedVoidchis.length !== 2;
        }

        function openCertModal(e, id) {
            e.stopPropagation();
            const v = voidchis.find(chi => chi.id === id);
            document.getElementById('certContent').innerHTML = `
                ID: ${v.id}<br>NAME: ${v.name}<br>GEN: ${v.generation || 0}<br>
                BORN: ${new Date(v.created_at).toUTCString()}<br>
                LINEAGE: ${v.parent1_id ? v.parent1_id + ' + ' + v.parent2_id : 'GENESIS ORIGIN'}
            `;
            document.getElementById('certificateModal').classList.add('active');
        }

        function closeCertModal() { document.getElementById('certificateModal').classList.remove('active'); }
        function openCreateModal() { document.getElementById('createModal').classList.add('active'); }
        function closeCreateModal() { document.getElementById('createModal').classList.remove('active'); }
        function openBreedModal() { document.getElementById('breedModal').classList.add('active'); }
        function closeBreedModal() { document.getElementById('breedModal').classList.remove('active'); }

        async function createVoidchi(e) {
            e.preventDefault();
            const name = document.getElementById('voidchiName').value;
            await fetch(`${API_BASE}/voidchi/create`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, traits: { curiosity: 0.5, stability: 0.5 } })
            });
            closeCreateModal();
            loadVoidchis();
        }

        async function confirmBreeding(e) {
            e.preventDefault();
            const name = document.getElementById('offspringName').value;
            await fetch(`${API_BASE}/voidchi/breed`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ parent1_id: selectedVoidchis[0], parent2_id: selectedVoidchis[1], name })
            });
            selectedVoidchis = [];
            closeBreedModal();
            loadVoidchis();
        }

        socket.on('voidchi_created', loadVoidchis);
        socket.on('breeding_completed', loadVoidchis);
        window.onload = loadVoidchis;
    </script>
</body>
</html>
